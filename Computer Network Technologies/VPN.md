Virtual Private Network

Connectivity realized on a shared infrastructure such that policies can be enforced as a private network

Shared infrastructure:
- private/public network
- the internet

Policies : security, quality of service, reliability, addressing

Tunnel : secure encapsulation of corporate traffic while in transit on the shared network. Not present in some solutions
VPN Gateway : Termination device on the corporate network. Might be a tunnel endpoint. 

Why VPN? 
VPNs enable cutting costs with respect to expensive connectivity solutions.
Private Networks are based on : private leased lines, Long distance dial-up solutions

VPNs enables selective and flexible access to corporate network (services)
- Limited services available to external users --> high security, few services allowed through firewall
- All intranet functionalities available to corporate users accessing from the Internet --> VPN connection allowed through firewall. Services available as if connected directly to the corporate network

### Basic Security Objectives

- **End Point authentication** : ensure it is what/who it declares to be
- **Data Integrity** : ensures data is not changed to prevent tampering
- **Data Confidentiality** : data cannot be accessed/read by anyone else than intended destination
- **Data Separation** : tunneling

Tunneling : a packet between private sites is carried through a public network within a packet handled by public nodes
![[Pasted image 20241023165554.png]]

Different types of VPNs
- **Site-to-Site VPN** : connect remote networks, virtualizes leased line
- **End-to-End VPN** : connect remote hosts, virtualizes leased line
- **Access VPN or remote VPN or virtual dial in** : connects terminal to remote network, virtualizes (dial-up) access connection

### S2S VPN Tunneling
Tunnel terminated on gateway
![[Pasted image 20241023171254.png]]
### E2E VPN Tunneling
Tunnel terminated on end systems
![[Pasted image 20241023171302.png]]
### Remote VPN Tunneling
Tunnel terminated on end system and VPN gateway
![[Pasted image 20241023171403.png]]
## VPN Scenarios

- **Intranet VPN** : Interconnection of corporate headquarters, remote offices, branch offices, telecommuter, traveling employee
![[Pasted image 20241023171505.png|500]]
- **Extranet VPN** : Interconnection of customers, suppliers, partners, or communities of interest to a corporate intranet, Provide controlled access to an individual customer/partner/provider user
![[Pasted image 20241023171518.png|500]]

Extranet specific issues: 
- Restricted access to network resources from interconnected networks
	- Firewall at VPN
- Overlapping Address Spaces
	- Network address translation
- Open, standard-based solution
	- enables interoperability among different organizations
- Traffic control
	- avoid that partner traffic compromises performance on corporate network
### Internet Access

- **Centralized** : remote branches/users use public IP network only to reach headquarters. Intenet access only from headquarters. VPN carries also traffic to and from the Internet. Centralized access flow (using firewalls)
![[Pasted image 20241023171919.png|500]]
- **Distributed** (voluntary connection) : Remote branches/users access the internet through their IP Network connection. VPN is deployed only for corporate traffic
![[Pasted image 20241023171932.png|500]]
### VPN Topologies

- Hub and spoke : each branch communicates directly with headquarters, fits to data flow of many corporations. routing is sub-optimal, small number of tunnels, hub could become bottleneck
- Mesh : larger number of tunnels (harder to manually configure), optimized routing

## Deployment Models
![[Pasted image 20241023175040.png]]
### Overlay Model
public network doesn't participate in realizing the VPN.
- It doesn't know where VPN destinations are
- Just connectivity among VPN gateways
Each VPN gateway must be in touch with every other VPN gateway
- highly meshed tunnels
Routing is performed by the VPN gateway
### Peer Model
Each VPN Gateway interacts with a public router (its peer)
- Exchange of routing information
- Service provider network disseminates routing information
Public Network routes traffic between gateways of the same VPN
### Customer Provisioned VPN
Customer implements VPN solution
- owns, configures, manages devices implementing VPN functionalities
Network provider is not aware that the traffic generated by customer is VPN
All VPN features implemented in customer devices
CE terminates tunnels
![[Pasted image 20241023175839.png]]
### Provider Provisioned VPN
Provider implements VPN solution
- owns, configures, manages devices implementing VPN functionalities
VPN state maintained by the provider devices
Traffic belonging to different VPNs is separated by the provider devices
CE may behave as if it were connected to a private network
PE terminates tunnels
![[Pasted image 20241023180008.png]]

Customer Provisioned vs. Provider Provisioned
- Customer
	- remote host has 2 addresses ISP assigned and corporate
	- remote host terminates VPN tunnel
	- remote host must activate tunnel. if tunnel not activated, client can operate without VPN
	- can be used from any internet connection (ISP)
- Provider
	- remote host has 1 address (corporate)
	- NAS terminates VPN tunnel
	- Remote host is always on VPN
	- Internet access is only centralized
	- Requires access to specific ISP

### Layer N VPN

Packet transport (tunneling) provided by Layer N protocol as Layer N service
![[Pasted image 20241023180538.png|500]]
![[Pasted image 20241023180544.png|500]]
![[Pasted image 20241023180628.png|500]]
![[Pasted image 20241023180635.png|500]]

## Generic Routing Encapsulation (GRE)

Packet format : Encapsulation (tunneling) of any protocol (including IP) into IP
Header version 0
![[Pasted image 20241023181340.png]]
![[Pasted image 20241023181412.png]]

- C, R, K, S : flags indicating the presence/absence of optional fields
- s : strict source routing flag, if the destination is not reached when the source route list end, the packet is dropped.
- Recur : Max. number of additional encapsulation permitted (must be 0)
- Protocol : ID of the payload protocol
- Routing : sequence of router IP addresses or ASs for source routing

PPTP performs a reliable service --> uses acknowledgements, so GRE header needs Ack. Number. There's some flags, and one of them is the ack. number flag.

## Layer 2 Frame, within an IP Packet

Two protocols for Access VPN:
- L2TP 
	- initially only provider provisioner, initially not widely implemented in terminals
	- independent of layer 2 protocol on host
	- security through IPsec, strong but complicated
- PPTP
	- Customer provisioner
	- originally proposed by Microsoft, Apple...
	- Weak encryption and authentication
	- Proprietary key management
### L2TP
Tunneling between public network access point and corporate network
	also wholesale dial-up services
L2TP Access Concentrator (LAC)
	network access device supporting L2TP
	NAS (Network Access Server)
L2TP Network Server (LSN)
	Corporate (VPN) Gateway
Customer provisioned deployment mode by including LAC functionality in host
![[Pasted image 20241023184122.png]]

Multiple sessions may exist within the same tunnel
Multiple tunnels may be established between the same LAC and LDN or multiple LNSs
![[Pasted image 20241023184209.png]]

L2TP Operation:
1. Establish a control connection for a tunnel between LAC and LNS
2. Establish one or more sessions triggered by a call request
The control connection must be established before a connection request is generated
A session must be established before tunneling PPP frames

Establishing a tunnel:
- Peer can be authenticated
- A shared secret must exist between LAC and LNS
- L2TP uses a CHAP-like mechanism
	- challenge-handshake authentication protocol
	- a challenge is proposed to the other peer
	- the correct answer to the challenge requires the shared secret
- The tunnel endpoints exchange the local ID attributed to the tunnel
![[Pasted image 20241023185841.png]]
